{% extends "layout.html" %}
{% block title %}
  {{ player.username }} {{ round.coursename }} {{ get_localization("hole") }} {{ hole_num }}
{% endblock title %}
{% block content %}
  <h2>{{ player.username }} {{ round.coursename }} {{ get_localization("hole") }} {{ hole_num }}</h2>
  <form action="{{ url_for('show_hole', round_id=round.id, player_id=player.id, hole_num=[round.num_holes, hole_num+1]|min) }}" method="post">
    {# Number input default buttons are not customizable. This component would not have buttons while opening the numeric input on mobile, could be preferable #}
    {# The usability is anyways bad without javascript so might as well just use the number type #}
    {# {{ components.user_input("text", "result", {"value":result, "readonly":"", "class":"result", "inputmode":"numeric", "pattern":"[0-9]*"}) }}<br/> #}
    {{ components.number_input("result", constants.hole_par_min, constants.hole_par_max, {"required":"", "value":display_result, "class":"result"}) }}<br/>
    {% set button_text = get_localization("to_next_hole_button") if hole_num < round.num_holes else get_localization("end_round_button")  %}
    <p>
      {% if hole_num > 1 %}
        <button class="style" formaction="{{ url_for('show_hole', round_id=round.id, player_id=player.id, hole_num=hole_num-1) }}" type="submit" name="previous_button" id="previous_button">{{ get_localization("to_previous_hole_button") }}</button>
      {% endif %}
      <button class="style" type="submit" name="next_button" id="next_button">{{ button_text }}</button>
    </p>
    {{ components.hidden_input("result_hole", hole_num) }}
    {{ components.csrf_token_input() }}
  </form>
  <h2>Tilanne</h2>
  <p>
    <table>
      <thead>
        <tr>
          <th scope="col">{{ get_localization("hole").capitalize() }}</th>
          {% for id, name in round["participators"].items() %}
            <th scope="col">{{ components.hole_link(round.id, id, hole_num, name) }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for i in range(1, 1 + round.num_holes|int) %}
          <tr>
            <th scope="row">{{ i|string }}</th>
            {% for id in round["participators"].keys() %}
              {% set hole_result = round_results[id][i]["result"] if i in round_results[id] else "-" %}
              {% set result_class = "" if hole_result == "-" else utilities.get_type_for_result(hole_result, round.hole_data[i|string]["par"]|int) %}
              <td class="{{ result_class }}">{{ hole_result }}</td>
            {% endfor %}
          </tr>
        {% endfor %}
        <tr>
          <th scope="row">{{ get_localization("total_header") }}</th>
          {% for id in round["participators"].keys() %}
            {% set total_result = round_results[id]["total"] if "total" in round_results[id] else "-" %}
            <td>{{ total_result }}</td>
          {% endfor %}
        </tr>
        <tr>
          <th scope="row">{{ get_localization("over_under_header") }}</th>
          {% for id in round["participators"].keys() %}
            {% set total_result = round_results[id]["total"] if "total" in round_results[id] else "-" %}
            {% set par = utilities.get_round_over_under_string(round_results[id], round.hole_data) %}
            <td>{{ par }}</td>
          {% endfor %}
        </tr>
      </tbody>
    </table>
  </p>
  <p>
    {{ components.round_link(round.id, get_localization("return_to_round_page_button")) }}
  </p>
{% endblock content %}
